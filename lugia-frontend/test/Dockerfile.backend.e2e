FROM golang:1.24-alpine

WORKDIR /app

# Install postgresql-client for psql
RUN apk add --no-cache postgresql-client

# Context is project root, so paths are relative to <project_root>
COPY lugia-backend/go.mod ./
COPY lugia-backend/go.sum ./

# Copy shared library
COPY jirachi /jirachi

RUN go mod download

# Context is project root, so copy lugia-backend/ subdirectory into /app
COPY lugia-backend/ .

# Context is project root, so 'database' is directly accessible
COPY database /database

RUN CGO_ENABLED=0 GOOS=linux go build -o main ./main.go

EXPOSE 23001

CMD ["/app/main"] 